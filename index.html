<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âè∞Êù± 1.5 Êó•ËàíÂ£ì‰πãÊóÖ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; }
        .timeline-line { position: absolute; left: 24px; top: 0; bottom: 0; width: 2px; background-color: #cbd5e1; z-index: 0; }
        .tab-active { border-bottom: 2px solid #0d9488; color: #0d9488; font-weight: bold; }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
    </style>
</head>
<body class="pb-20">

    <header class="bg-teal-600 text-white p-4 sticky top-0 z-50 shadow-md">
        <h1 class="text-xl font-bold text-center"><i class="fas fa-map-marked-alt mr-2"></i>Âè∞Êù± 1.5 Êó•ËàíÂ£ì‰πãÊóÖ</h1>
        <p class="text-xs text-center text-teal-100 mt-1">2025/12/14 ‚Üí 15</p>
    </header>

   <div id="weather-card" class="mx-4 mt-2 mb-4 relative z-50 bg-white rounded-xl shadow-lg border-t-4 border-blue-400 p-4 hidden">
        <div class="flex justify-between items-center mb-3">
            <div>
                <h2 class="text-sm text-gray-500 font-bold tracking-wide">Âè∞Êù±Âç≥ÊôÇÂ§©Ê∞£</h2>
                <div class="flex items-end mt-1">
                    <span id="current-temp" class="text-3xl font-bold text-gray-800">--</span>
                    <span class="text-lg text-gray-600 mb-1 ml-1">¬∞C</span>
                </div>
                <p id="weather-desc" class="text-xs text-gray-400 mt-1">ËºâÂÖ•‰∏≠...</p>
            </div>
            <div class="text-right">
                <div id="weather-icon" class="text-4xl text-blue-300 mb-1">
                    <i class="fas fa-cloud-sun"></i>
                </div>
                <div class="text-xs font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded-full inline-block">
                    <i class="fas fa-umbrella mr-1"></i>ÈôçÈõ®Áéá <span id="rain-chance">--</span>%
                </div>
            </div>
        </div>

        <div class="border-t border-gray-100 my-2"></div>

        <div id="hourly-forecast" class="grid grid-cols-4 gap-2 text-center pt-1">
            <div class="text-xs text-gray-400">ËºâÂÖ•‰∏≠</div>
        </div>
    </div>
    
    <div class="flex justify-around bg-white p-3 sticky top-16 z-40 shadow-sm border-b">
        <button onclick="switchTab('day1')" id="btn-day1" class="tab-active w-1/3 pb-2 text-center">Day 1</button>
        <button onclick="switchTab('day2')" id="btn-day2" class="w-1/3 pb-2 text-center text-gray-500">Day 2</button>
        <button onclick="switchTab('extra')" id="btn-extra" class="w-1/3 pb-2 text-center text-gray-500">È†ÜÈÅäÊôØÈªû</button>
    </div>

    <div class="max-w-md mx-auto p-4 relative">
        
        <div id="day1" class="tab-content">
            <div class="relative pl-4">
                <div class="timeline-line"></div>
                
                <div id="day1-list"></div>

            </div>
        </div>

        <div id="day2" class="tab-content hidden">
            <div class="relative pl-4">
                <div class="timeline-line"></div>
                <div id="day2-list"></div>
            </div>
        </div>

        <div id="extra" class="tab-content hidden">
            <div id="extra-list" class="space-y-4"></div>
        </div>

    </div>

    <script>
        // Data Structure
        const day1Data = [
            { time: "08:47", title: "ÊùæÂ±±ËªäÁ´ô Ëá™Âº∑472Ê¨°", type: "begin", duration: "3Â∞èÊôÇ43ÂàÜ", icon: "fa-train", note: "Ëªä‰∏ä‰∫´Áî®ÂçàÈ§ê*Âè∞ÈêµÊéíÈ™®‰æøÁï∂*" },
            { time: "13:06", title: "ÊäµÈÅîÂè∞Êù±ËªäÁ´ô", type: "carrent", duration: "9ÂàÜ", icon: "fa-suitcase", note: "ÂâçÂæÄÂíåÈÅãÁßüËªä" },
            { time: "13:15", title: "Âè∞Êù±ÂíåÈÅãÁßüËªäÂá∫Áôº", type: "transport", duration: "20ÂàÜ", icon: "fa-car-side", note: "Ê∫ñÊôÇÂá∫ÁôºÔºåÂâçÂæÄÊ£ÆÊûóÂÖ¨Âúí" },
            { time: "13:35", title: "Âè∞Êù±Ê£ÆÊûóÂÖ¨Âúí", type: "activity", duration: "40ÂàÜ", icon: "fa-tree", note: "ÊòìÂÅúËªä„ÄÅÊπñÊôØÊï£Ê≠•„ÄÅËá™Ë°åËªäÈÅì" },
            { time: "14:15", title: "ÂâçÂæÄÂØåÂ≤°ÊºÅÊ∏Ø", type: "transport", duration: "10ÂàÜ", icon: "fa-car", note: "ËªäÁ®ãÁü≠ÔºåËøëÊµ∑ÈÇä" },
            { time: "14:25", title: "ÂØåÂ≤°ÊºÅÊ∏Ø", type: "activity", duration: "35ÂàÜ", icon: "fa-ship", note: "ÁúãÊµ∑„ÄÅÂêÉÊµ∑Âë≥Â∞èÂêÉ„ÄÅÂñùÈ£≤Êñô" },
            { time: "15:00", title: "ÂâçÂæÄÂàùÈπøÁâßÂ†¥", type: "transport", duration: "25ÂàÜ", icon: "fa-car", note: "Â±±ÂçÄË∑ØÊ≥ÅËâØÂ•Ω" },
            { time: "15:25", title: "ÂàùÈπøÁâßÂ†¥", type: "activity", duration: "1Â∞èÊôÇ", icon: "fa-house-chimney-window", note: "ËçâÂéüÊãçÁÖß„ÄÅÂñùÈÆÆÂ•∂„ÄÅË¶™Â≠êÂãïÁâ©ÂçÄ" },
            { time: "16:30", title: "ÂâçÂæÄÁü•Êú¨ËÄÅÁà∫ÈÖíÂ∫ó", type: "transport", duration: "45ÂàÜ", icon: "fa-car", note: "Ê∫ñÂÇô Check-in" },
            { time: "17:15", title: "Áü•Êú¨ËÄÅÁà∫ÈÖíÂ∫ó (‰∏ÄÊ≥ä‰∫åÈ£ü)", type: "hotel", duration: "Ëá™Áî±", icon: "fa-bed", note: "Ê≥°ÊπØ„ÄÅÊôöÈ§ê„ÄÅ‰∫´ÂèóÈ£ØÂ∫óË®≠ÊñΩ" },
            { time: "19:30", title: "Áü•Êú¨ËÄÅÁà∫ÈÖíÂ∫óÈÇ£È≠ØÁÅ£È§êÂª≥ÊôöÈ§ê", type: "food", duration: "90ÂàÜ", icon: "fa-utensils", note: "Âª∫Ë≠∞ÂêÉÈ£Ω‰ºëÊÅØÂçäÂ∞èÊôÇÂÜçÊ≥°ÊπØ" }
        ];

        const day2Data = [
            { time: "07:00", title: "Áü•Êú¨ËÄÅÁà∫ÈÖíÂ∫óÊó©È§ê", type: "food", duration: "2Â∞èÊôÇ", icon: "fa-coffee", note: "‰∫´ÂèóÊÇ†ÈñíÊó©Êô®" },
            { time: "09:00", title: "ÂâçÂæÄÁü•Êú¨Ê£ÆÊûóÈÅäÊ®ÇÂçÄ", type: "transport", duration: "10ÂàÜ", icon: "fa-car", note: "‰∏äÂù°Ë∑ØÊÆµ" },
            { time: "09:10", title: "Áü•Êú¨ÂúãÂÆ∂Ê£ÆÊûóÈÅäÊ®ÇÂçÄ", type: "activity", duration: "1h 50m", icon: "fa-hiking", note: "Ëµ∞ÂêäÊ©ã„ÄÅÊ£ÆÊûóÊµ¥„ÄÅÊ∑±ÂëºÂê∏" },
            { time: "11:00", title: "ÂâçÂæÄÁü•Êú¨Ë°óÂçÄ", type: "transport", duration: "10ÂàÜ", icon: "fa-car", note: "" },
            { time: "11:10", title: "Áü•Êú¨Ë°óÂçÄÂçàÈ§ê", type: "food", duration: "1Â∞èÊôÇ", icon: "fa-utensils", note: "Âú®Âú∞È§êÂª≥ÈÅ∏ÊìáÂ§ö" },
            { time: "12:10", title: "ÂâçÂæÄÂ§öËâØËªäÁ´ô", type: "transport", duration: "45ÂàÜ", icon: "fa-car", note: "Ê≤øÊµ∑ÂÖ¨Ë∑ØÊôØËâ≤Áµï‰Ω≥" },
            { time: "13:00", title: "Â§öËâØËªäÁ´ô", type: "activity", duration: "1Â∞èÊôÇ", icon: "fa-camera", note: "ÂÖ®Âè∞ÊúÄÁæéËªäÁ´ô„ÄÅÁÜ±ÈñÄÊâìÂç°Èªû" },
            { time: "14:00", title: "ÂõûÂè∞Êù±Â∏ÇÂçÄ", type: "transport", duration: "60ÂàÜ", icon: "fa-car", note: "ÂõûÁ®ãËºÉÈÅ†ÔºåÊ≥®ÊÑèÁ≤æÁ•û" },
            { time: "15:00", title: "Âè∞Êù±Â∏ÇÂçÄÈÄõË°ó", type: "activity", duration: "1Â∞èÊôÇ", icon: "fa-shopping-bag", note: "Ê≠£Ê∞£Ë∑ØÂïÜÂúà„ÄÅË≤∑‰º¥ÊâãÁ¶Æ" },
            { time: "16:00", title: "ÂâçÂæÄÂè∞Êù±ËªäÁ´ô", type: "transport", duration: "20ÂàÜ", icon: "fa-suitcase", note: "È†êÁïôÈÇÑËªä/Ë≤∑ÊôöÈ§êÊôÇÈñì" },
            { time: "17:15", title: "ÈÇÑËªä", type: "carrent", duration: "", icon: "fa-car-side", note: "ÊúÄÂæåÈÇÑËªäÊôÇÈñì" },
            { time: "17:46", title: "Âè∞Êù±ËªäÁ´ô Ëá™Âº∑441Ê¨°", type: "end", duration: "3Â∞èÊôÇ44ÂàÜ", icon: "fa-flag-checkered", note: "Âπ≥ÂÆâËøîÂÆ∂" }
        ];

        const extraData = [
            { area: "‚õΩ Ê≤øÈÄîÂä†Ê≤πÁ´ô", spots: [
                { name: "‰∏≠Ê≤π Âè∞Êù±Á´ô (ËªäÁ´ôÊóÅ)", desc: "Êõ¥ÁîüÂåóË∑ØÔºåÂèñËªä/ÈÇÑËªäÊúÄÊñπ‰æø", time: "07:00-22:00" },
                { name: "‰∏≠Ê≤π Áü•Êú¨Á´ô (ÈÄ≤È£ØÂ∫óÂâç)", desc: "ÂÖ•Áü•Êú¨Ê∫´Ê≥âÂçÄÂâçÊúÄÂæå‰∏ÄÁ´ôÔºåÂª∫Ë≠∞Ë£úÁµ¶", time: "07:00-21:00" },
                { name: "‰∏≠Ê≤π ÂàùÈπøÁ´ô (Â±±Á∑ö)", desc: "Âè∞9Á∑öÊóÅÔºåÂàùÈπøÁâßÂ†¥ÂÖ•Âè£Ëôï", time: "07:00-21:00" },
                { name: "‰∏≠Ê≤π Â§™È∫ªÈáåÁ´ô (Â§öËâØ)", desc: "ÂçóËø¥ÂÖ¨Ë∑Ø‰∏≠ÁπºÁ´ôÔºåÂæÄÂ§öËâØÂøÖÁ∂ì", time: "07:00-21:00" }
            ]},
            { area: "üîπ Âè∞Êù±ËªäÁ´ô ‚Üí Â∏ÇÂçÄÈôÑËøë", spots: [
                { name: "ÈêµËä±ÊùëÈü≥Ê®ÇËÅöËêΩ", desc: "ÊñáÂâµÂ∏ÇÈõÜ„ÄÅË£ùÁΩÆËóùË°ì (ÈÅ©ÂêàÊôöÈñì)", time: "30-60ÂàÜ" },
                { name: "Ê≠£Ê∞£Ë∑ØÂïÜÂúà", desc: "Áü•ÂêçÂ∞èÂêÉ„ÄÅ‰º¥ÊâãÁ¶ÆËÅöÈõÜÂú∞", time: "20-40ÂàÜ" }
            ]},
            { area: "üîπ Â∏ÇÂçÄ ‚Üí ÂØåÂ≤° ‚Üí ÂàùÈπø", spots: [
                { name: "Â∞èÈáéÊü≥", desc: "Â•áÁâπÊµ∑Â≤∏Âú∞ÂΩ¢ÔºåÂ∞±Âú®ÂØåÂ≤°ÊóÅ", time: "40-60ÂàÜ" },
                { name: "ÂçëÂçóÈÅ∫ÂùÄÂÖ¨Âúí", desc: "Â§ßËçâÁöÆ„ÄÅÊñáÂåñÈÅ∫Ë∑°„ÄÅÊ∂º‰∫≠", time: "20-40ÂàÜ" }
            ]},
            { area: "üîπ Áü•Êú¨Âë®ÈÇä", spots: [
                { name: "ÁôΩÁéâÁÄëÂ∏É", desc: "Â∞èÂûãÂ±±ÂçÄÁÄëÂ∏É (ËºÉÂÜ∑ÈñÄ)", time: "20-25ÂàÜ" },
                { name: "Áü•Êú¨Ê∫´Ê≥âË°ó", desc: "ÁÖÆÊ∫´Ê≥âËõã„ÄÅÈÄõÂ∞èÂ∫ó", time: "20-40ÂàÜ" }
            ]},
             { area: "üîπ ÂçóËø¥ÊñπÂêë (Â§öËâØ)", spots: [
                { name: "ÈáëÊ®ΩÈô∏ÈÄ£Â≥∂ËßÄÊôØÂè∞", desc: "Êµ∑Â≤∏ÂΩéÊúàÊôØËâ≤ (ÂõûÁ®ãÊñπÂêë)", time: "20-30ÂàÜ" },
                { name: "ËèØÊ∫êÊµ∑ÁÅ£", desc: "Â§ßËçâÂú∞„ÄÅÊµ∑Â≤∏Á∑öÊãçÁÖßÈªû", time: "20-40ÂàÜ" }
            ]}
        ];

        // Render Functions
        function renderTimeline(data, elementId) {
            const container = document.getElementById(elementId);
            let html = '';
            
            data.forEach(item => {
                const isActivity = item.type === 'activity' || item.type === 'food' || item.type === 'hotel';
                const bgColor = isActivity ? 'bg-white' : 'bg-gray-50';
                const borderColor = isActivity ? 'border-teal-500' : 'border-gray-300';
                const googleMapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.title.replace('ÂâçÂæÄ', '').replace('Âõû', ''))}`;

                html += `
                <div class="relative z-10 mb-6 pl-6">
                    <div class="absolute -left-3 top-0 w-8 h-8 rounded-full ${isActivity ? 'bg-teal-500' : 'bg-gray-400'} text-white flex items-center justify-center shadow-md border-2 border-white">
                        <i class="fas ${item.icon} text-xs"></i>
                    </div>
                    
                    <div class="${bgColor} p-4 rounded-lg card-shadow border-l-4 ${borderColor}">
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-gray-800 text-lg">${item.title}</h3>
                            <span class="text-sm font-mono text-teal-700 font-bold">${item.time}</span>
                        </div>
                        
                        <div class="mt-2 text-sm text-gray-600 flex items-center">
                            ${item.duration ? `<span class="bg-gray-200 px-2 py-0.5 rounded text-xs mr-2"><i class="far fa-clock mr-1"></i>${item.duration}</span>` : ''}
                        </div>
                        
                        <p class="mt-2 text-gray-500 text-sm leading-relaxed">${item.note}</p>
                        
                        ${item.type !== 'end' && item.type !== 'begin' && item.type !== 'carrent' ? `
                        <a href="${googleMapUrl}" target="_blank" class="mt-3 inline-block w-full text-center py-2 rounded border border-teal-500 text-teal-600 text-sm hover:bg-teal-50 transition">
                            <i class="fas fa-location-arrow mr-1"></i> Â∞éËà™
                        </a>` : ''}
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        function renderExtras() {
            const container = document.getElementById('extra-list');
            let html = '';
            
            extraData.forEach(group => {
                html += `
                <div class="bg-white rounded-lg p-4 card-shadow mb-4">
                    <h3 class="font-bold text-teal-700 border-b pb-2 mb-3">${group.area}</h3>
                    <div class="space-y-3">
                        ${group.spots.map(spot => `
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="font-bold text-gray-800">${spot.name}</div>
                                    <div class="text-xs text-gray-500">${spot.desc}</div>
                                </div>
                                <div class="text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded whitespace-nowrap">${spot.time}</div>
                            </div>
                            <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(spot.name)}" target="_blank" class="text-xs text-blue-500 block mt-1 hover:underline"><i class="fas fa-map-marker-alt"></i> Êü•Áúã‰ΩçÁΩÆ</a>
                        `).join('<hr class="my-2 border-dashed border-gray-200">')}
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        // Tab Switching Logic
        function switchTab(tabName) {
            // Hide all contents
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            // Show selected content
            document.getElementById(tabName).classList.remove('hidden');
            
            // Reset buttons
            document.querySelectorAll('button[id^="btn-"]').forEach(btn => {
                btn.classList.remove('tab-active', 'text-teal-700');
                btn.classList.add('text-gray-500');
            });
            // Highlight active button
            const activeBtn = document.getElementById(`btn-${tabName}`);
            activeBtn.classList.add('tab-active', 'text-teal-700');
            activeBtn.classList.remove('text-gray-500');
        }

// Weather Functions (CWA ÁµÇÊ•µÁâà - ÂÖ®Ê¨Ñ‰ΩçÂ§ßÂ∞èÂØ´ÈÄöÂêÉ)
        async function fetchWeather() {
            const weatherCard = document.getElementById('weather-card');
            const hourlyContainer = document.getElementById('hourly-forecast');
            
            // ‚úÖ ÊÇ®ÁöÑ API Key
            const CWA_KEY = 'CWA-238CE5CA-08E3-4392-8F7D-23AAD6B5814E'; 
            
            const url = `https://opendata.cwa.gov.tw/api/v1/rest/datastore/F-D0047-039?Authorization=${CWA_KEY}&elementName=T,Wx,PoP12h,PoP6h`;

            function getCwaIcon(wxString) {
                if (!wxString) return { icon: 'fa-question', color: 'text-gray-300' };
                if (wxString.includes('Èõ∑')) return { icon: 'fa-bolt', color: 'text-purple-500' };
                if (wxString.includes('Èõ®')) return { icon: 'fa-umbrella', color: 'text-blue-500' };
                if (wxString.includes('Êô¥') && wxString.includes('Èõ≤')) return { icon: 'fa-cloud-sun', color: 'text-orange-400' };
                if (wxString.includes('Êô¥')) return { icon: 'fa-sun', color: 'text-yellow-400' };
                if (wxString.includes('Èô∞')) return { icon: 'fa-cloud', color: 'text-gray-500' };
                if (wxString.includes('Èõ≤')) return { icon: 'fa-cloud', color: 'text-gray-400' };
                return { icon: 'fa-cloud-sun', color: 'text-teal-500' };
            }

            // ËºîÂä©ÂáΩÂºèÔºöÂÆâÂÖ®ÂèñÂæóÂ±¨ÊÄß (‰∏çÂàÜÂ§ßÂ∞èÂØ´)
            function getProp(obj, keyName) {
                if (!obj) return undefined;
                // Áõ¥Êé•ÂòóË©¶Â∏∏Ë¶ãÁöÑÂ§ßÂ∞èÂØ´ÁµÑÂêà
                return obj[keyName] || 
                       obj[keyName.charAt(0).toUpperCase() + keyName.slice(1)] || 
                       obj[keyName.toLowerCase()];
            }

            try {
                const response = await fetch(url);
                const data = await response.json();

                // 1. Êâæ Locations (Â§ßÂØ´ÊàñÂ∞èÂØ´)
                const locationsWrapper = getProp(data.records, 'locations');
                
                if (!locationsWrapper) {
                    throw new Error(`Êâæ‰∏çÂà∞ locations/LocationsÔºåÁèæÊúâ: [${Object.keys(data.records).join(', ')}]`);
                }

                const countyData = locationsWrapper[0];

                // 2. Êâæ Location (Â§ßÂØ´ÊàñÂ∞èÂØ´)
                const allTowns = getProp(countyData, 'location');
                
                if (!allTowns) {
                    throw new Error(`Êâæ‰∏çÂà∞ location/Location ÂàóË°®`);
                }

                // 3. ÊâæËá∫Êù±Â∏Ç (‰ΩøÁî® getProp ÊäìÂèñ LocationName Êàñ locationName)
                const targetTown = allTowns.find(town => {
                    const name = getProp(town, 'locationName');
                    return name === 'Ëá∫Êù±Â∏Ç' || name === 'Âè∞Êù±Â∏Ç';
                });

                if (!targetTown) {
                    // Â¶ÇÊûúÊâæ‰∏çÂà∞ÔºåÂç∞Âá∫Á¨¨‰∏ÄÁ≠ÜË≥áÊñôÁöÑÊâÄÊúâÊ¨Ñ‰ΩçÂêçÁ®±ÔºåËÆìÊàëÂÄëÁü•ÈÅìÂÆÉÂà∞Â∫ïÂè´‰ªÄÈ∫º
                    const firstTownKeys = allTowns.length > 0 ? Object.keys(allTowns[0]).join(', ') : "Á©∫Èô£Âàó";
                    throw new Error(`Êâæ‰∏çÂà∞Ëá∫Êù±Â∏Ç„ÄÇÁ¨¨‰∏ÄÁ≠ÜË≥áÊñôÁöÑÊ¨Ñ‰ΩçÊúâ: [${firstTownKeys}]`);
                }

                // --- ÊàêÂäüÔºÅÈñãÂßãËß£ÊûêË≥áÊñô (ÊâÄÊúâÊ¨Ñ‰ΩçÈÉΩÁî® getProp ÂåÖËµ∑‰æÜ) ---
                
                const elements = getProp(targetTown, 'weatherElement');
                const weatherMap = {};
                elements.forEach(el => { 
                    // ÂèñÂæó elementName (Êàñ ElementName)
                    const name = getProp(el, 'elementName');
                    // ÂèñÂæó time (Êàñ Time)
                    const time = getProp(el, 'time');
                    weatherMap[name] = time; 
                });

                // ËºîÂä©ÔºöËÆÄÂèñÊï∏ÂÄº
                const getValue = (elArr, index) => {
                    if (!elArr || !elArr[index]) return '--';
                    const elVal = getProp(elArr[index], 'elementValue');
                    if (!elVal || !elVal[0]) return '--';
                    return getProp(elVal[0], 'value');
                };

                const currentWx = getValue(weatherMap['Wx'], 0);
                const currentT = getValue(weatherMap['T'], 0);
                
                let currentRain = '0';
                const popArr = weatherMap['PoP6h'] || weatherMap['PoP12h'];
                const rawPop = getValue(popArr, 0);
                if (rawPop !== '--' && rawPop !== ' ') currentRain = rawPop;

                let maxT = -100, minT = 100;
                const tArr = weatherMap['T'];
                const checkLimit = Math.min(8, tArr ? tArr.length : 0);
                
                for(let i=0; i<checkLimit; i++) {
                    const val = getValue(tArr, i);
                    if (val !== '--') {
                        const t = parseInt(val);
                        if(t > maxT) maxT = t;
                        if(t < minT) minT = t;
                    }
                }
                
                if (maxT === -100) { maxT = '-'; minT = '-'; }

                const iconInfo = getCwaIcon(currentWx);
                document.getElementById('current-temp').innerText = currentT;
                document.getElementById('rain-chance').innerText = currentRain;
                document.getElementById('weather-icon').innerHTML = `<i class="fas ${iconInfo.icon} ${iconInfo.color}"></i>`;
                document.getElementById('weather-desc').innerText = `${currentWx} (È´ò${maxT}¬∞ ‰Ωé${minT}¬∞)`;

                let html = '';
                for(let i = 1; i <= 3; i++) {
                    if (weatherMap['T'] && weatherMap['T'][i]) {
                        const timeStr = getProp(weatherMap['T'][i], 'startTime'); 
                        const timeDisplay = timeStr.split(' ')[1].substring(0, 5);
                        
                        const valT = getValue(weatherMap['T'], i);
                        const valWx = getValue(weatherMap['Wx'], i);
                        
                        let valPop = '0';
                        const subPopList = weatherMap['PoP6h'] || weatherMap['PoP12h'];
                        if(subPopList) {
                            // ÈÄôË£°Á∞°ÂåñÊØîÂ∞çÈÇèËºØ
                            const raw = getValue(subPopList, 0); // Êö´ÊôÇÂèñÁ¨¨‰∏ÄÁ≠Ü‰ª£Ë°®ÔºåÊàñÊòØÂØ´Êõ¥Ë§áÈõúÁöÑÊØîÂ∞ç
                            // ÁÇ∫‰∫ÜÁ≤æÁ¢∫ÊØîÂ∞çÊôÇÈñì:
                             const endTime = getProp(weatherMap['T'][i], 'endTime');
                             const match = subPopList.find(p => {
                                 return getProp(p, 'startTime') === timeStr || getProp(p, 'endTime') === endTime;
                             });
                             if (match) {
                                 const matchVal = getProp(getProp(match, 'elementValue')[0], 'value');
                                 if (matchVal !== ' ') valPop = matchVal;
                             }
                        }

                        const subIcon = getCwaIcon(valWx);

                        html += `
                        <div class="flex flex-col items-center justify-center bg-blue-50 rounded p-2 col-span-1">
                            <span class="text-xs text-gray-500 mb-1 font-bold">${timeDisplay}</span>
                            <i class="fas ${subIcon.icon} ${subIcon.color} text-lg mb-1"></i>
                            <span class="text-sm font-bold text-gray-700">${valT}¬∞</span>
                            <span class="text-[10px] text-blue-500"><i class="fas fa-tint text-[8px]"></i> ${valPop}%</span>
                        </div>`;
                    }
                }

                hourlyContainer.className = "grid grid-cols-3 gap-2 text-center pt-2"; 
                hourlyContainer.innerHTML = html;
                weatherCard.classList.remove('hidden');

            } catch (error) {
                console.error("Weather Error:", error);
                document.getElementById('weather-desc').innerText = "ËÆÄÂèñÂ§±Êïó";
                
                hourlyContainer.innerHTML = `
                    <div class="col-span-3 text-red-600 text-xs text-left p-2 bg-red-50 rounded" style="word-break: break-all;">
                        <strong>ÈåØË™§:</strong> ${error.message}
                    </div>`;
                weatherCard.classList.remove('hidden');
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderTimeline(day1Data, 'day1-list');
            renderTimeline(day2Data, 'day2-list');
            renderExtras();
            fetchWeather();
        });
    </script>
</body>
</html>
