<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°æ± 1.5 æ—¥èˆ’å£“ä¹‹æ—…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; }
        .timeline-line { position: absolute; left: 24px; top: 0; bottom: 0; width: 2px; background-color: #cbd5e1; z-index: 0; }
        .tab-active { border-bottom: 2px solid #0d9488; color: #0d9488; font-weight: bold; }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
    </style>
</head>
<body class="pb-20">

    <header class="bg-teal-600 text-white p-4 sticky top-0 z-50 shadow-md">
        <h1 class="text-xl font-bold text-center"><i class="fas fa-map-marked-alt mr-2"></i>å°æ± 1.5 æ—¥èˆ’å£“ä¹‹æ—…</h1>
        <p class="text-xs text-center text-teal-100 mt-1">2025/12/14 â†’ 15</p>
    </header>

   <div id="weather-card" class="mx-4 mt-2 mb-4 relative z-50 bg-white rounded-xl shadow-lg border-t-4 border-blue-400 p-4 hidden">
        <div class="flex justify-between items-center mb-3">
            <div>
                <h2 class="text-sm text-gray-500 font-bold tracking-wide">å°æ±å³æ™‚å¤©æ°£</h2>
                <div class="flex items-end mt-1">
                    <span id="current-temp" class="text-3xl font-bold text-gray-800">--</span>
                    <span class="text-lg text-gray-600 mb-1 ml-1">Â°C</span>
                </div>
                <p id="weather-desc" class="text-xs text-gray-400 mt-1">è¼‰å…¥ä¸­...</p>
            </div>
            <div class="text-right">
                <div id="weather-icon" class="text-4xl text-blue-300 mb-1">
                    <i class="fas fa-cloud-sun"></i>
                </div>
                <div class="text-xs font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded-full inline-block">
                    <i class="fas fa-umbrella mr-1"></i>é™é›¨ç‡ <span id="rain-chance">--</span>%
                </div>
            </div>
        </div>

        <div class="border-t border-gray-100 my-2"></div>

        <div id="hourly-forecast" class="grid grid-cols-4 gap-2 text-center pt-1">
            <div class="text-xs text-gray-400">è¼‰å…¥ä¸­</div>
        </div>
    </div>
    
    <div class="flex justify-around bg-white p-3 sticky top-16 z-40 shadow-sm border-b">
        <button onclick="switchTab('day1')" id="btn-day1" class="tab-active w-1/3 pb-2 text-center">Day 1</button>
        <button onclick="switchTab('day2')" id="btn-day2" class="w-1/3 pb-2 text-center text-gray-500">Day 2</button>
        <button onclick="switchTab('extra')" id="btn-extra" class="w-1/3 pb-2 text-center text-gray-500">é †éŠæ™¯é»</button>
    </div>

    <div class="max-w-md mx-auto p-4 relative">
        
        <div id="day1" class="tab-content">
            <div class="relative pl-4">
                <div class="timeline-line"></div>
                
                <div id="day1-list"></div>

            </div>
        </div>

        <div id="day2" class="tab-content hidden">
            <div class="relative pl-4">
                <div class="timeline-line"></div>
                <div id="day2-list"></div>
            </div>
        </div>

        <div id="extra" class="tab-content hidden">
            <div id="extra-list" class="space-y-4"></div>
        </div>

    </div>

    <script>
        // Data Structure
        const day1Data = [
            { time: "08:47", title: "æ¾å±±è»Šç«™ è‡ªå¼·472æ¬¡", type: "begin", duration: "3å°æ™‚43åˆ†", icon: "fa-train", note: "è»Šä¸Šäº«ç”¨åˆé¤*å°éµæ’éª¨ä¾¿ç•¶*" },
            { time: "13:06", title: "æŠµé”å°æ±è»Šç«™", type: "carrent", duration: "9åˆ†", icon: "fa-suitcase", note: "å‰å¾€å’Œé‹ç§Ÿè»Š" },
            { time: "13:15", title: "å°æ±å’Œé‹ç§Ÿè»Šå‡ºç™¼", type: "transport", duration: "20åˆ†", icon: "fa-car-side", note: "æº–æ™‚å‡ºç™¼ï¼Œå‰å¾€æ£®æ—å…¬åœ’" },
            { time: "13:35", title: "å°æ±æ£®æ—å…¬åœ’", type: "activity", duration: "40åˆ†", icon: "fa-tree", note: "æ˜“åœè»Šã€æ¹–æ™¯æ•£æ­¥ã€è‡ªè¡Œè»Šé“" },
            { time: "14:15", title: "å‰å¾€å¯Œå²¡æ¼æ¸¯", type: "transport", duration: "10åˆ†", icon: "fa-car", note: "è»Šç¨‹çŸ­ï¼Œè¿‘æµ·é‚Š" },
            { time: "14:25", title: "å¯Œå²¡æ¼æ¸¯", type: "activity", duration: "35åˆ†", icon: "fa-ship", note: "çœ‹æµ·ã€åƒæµ·å‘³å°åƒã€å–é£²æ–™" },
            { time: "15:00", title: "å‰å¾€åˆé¹¿ç‰§å ´", type: "transport", duration: "25åˆ†", icon: "fa-car", note: "å±±å€è·¯æ³è‰¯å¥½" },
            { time: "15:25", title: "åˆé¹¿ç‰§å ´", type: "activity", duration: "1å°æ™‚", icon: "fa-house-chimney-window", note: "è‰åŸæ‹ç…§ã€å–é®®å¥¶ã€è¦ªå­å‹•ç‰©å€" },
            { time: "16:30", title: "å‰å¾€çŸ¥æœ¬è€çˆºé…’åº—", type: "transport", duration: "45åˆ†", icon: "fa-car", note: "æº–å‚™ Check-in" },
            { time: "17:15", title: "çŸ¥æœ¬è€çˆºé…’åº— (ä¸€æ³ŠäºŒé£Ÿ)", type: "hotel", duration: "è‡ªç”±", icon: "fa-bed", note: "æ³¡æ¹¯ã€æ™šé¤ã€äº«å—é£¯åº—è¨­æ–½" },
            { time: "19:30", title: "çŸ¥æœ¬è€çˆºé…’åº—é‚£é­¯ç£é¤å»³æ™šé¤", type: "food", duration: "90åˆ†", icon: "fa-utensils", note: "å»ºè­°åƒé£½ä¼‘æ¯åŠå°æ™‚å†æ³¡æ¹¯" }
        ];

        const day2Data = [
            { time: "07:00", title: "çŸ¥æœ¬è€çˆºé…’åº—æ—©é¤", type: "food", duration: "2å°æ™‚", icon: "fa-coffee", note: "äº«å—æ‚ é–’æ—©æ™¨" },
            { time: "09:00", title: "å‰å¾€çŸ¥æœ¬æ£®æ—éŠæ¨‚å€", type: "transport", duration: "10åˆ†", icon: "fa-car", note: "ä¸Šå¡è·¯æ®µ" },
            { time: "09:10", title: "çŸ¥æœ¬åœ‹å®¶æ£®æ—éŠæ¨‚å€", type: "activity", duration: "1h 50m", icon: "fa-hiking", note: "èµ°åŠæ©‹ã€æ£®æ—æµ´ã€æ·±å‘¼å¸" },
            { time: "11:00", title: "å‰å¾€çŸ¥æœ¬è¡—å€", type: "transport", duration: "10åˆ†", icon: "fa-car", note: "" },
            { time: "11:10", title: "çŸ¥æœ¬è¡—å€åˆé¤", type: "food", duration: "1å°æ™‚", icon: "fa-utensils", note: "åœ¨åœ°é¤å»³é¸æ“‡å¤š" },
            { time: "12:10", title: "å‰å¾€å¤šè‰¯è»Šç«™", type: "transport", duration: "45åˆ†", icon: "fa-car", note: "æ²¿æµ·å…¬è·¯æ™¯è‰²çµ•ä½³" },
            { time: "13:00", title: "å¤šè‰¯è»Šç«™", type: "activity", duration: "1å°æ™‚", icon: "fa-camera", note: "å…¨å°æœ€ç¾è»Šç«™ã€ç†±é–€æ‰“å¡é»" },
            { time: "14:00", title: "å›å°æ±å¸‚å€", type: "transport", duration: "60åˆ†", icon: "fa-car", note: "å›ç¨‹è¼ƒé ï¼Œæ³¨æ„ç²¾ç¥" },
            { time: "15:00", title: "å°æ±å¸‚å€é€›è¡—", type: "activity", duration: "1å°æ™‚", icon: "fa-shopping-bag", note: "æ­£æ°£è·¯å•†åœˆã€è²·ä¼´æ‰‹ç¦®" },
            { time: "16:00", title: "å‰å¾€å°æ±è»Šç«™", type: "transport", duration: "20åˆ†", icon: "fa-suitcase", note: "é ç•™é‚„è»Š/è²·æ™šé¤æ™‚é–“" },
            { time: "17:15", title: "é‚„è»Š", type: "carrent", duration: "", icon: "fa-car-side", note: "æœ€å¾Œé‚„è»Šæ™‚é–“" },
            { time: "17:46", title: "å°æ±è»Šç«™ è‡ªå¼·441æ¬¡", type: "end", duration: "3å°æ™‚44åˆ†", icon: "fa-flag-checkered", note: "å¹³å®‰è¿”å®¶" }
        ];

        const extraData = [
            { area: "â›½ æ²¿é€”åŠ æ²¹ç«™", spots: [
                { name: "ä¸­æ²¹ å°æ±ç«™ (è»Šç«™æ—)", desc: "æ›´ç”ŸåŒ—è·¯ï¼Œå–è»Š/é‚„è»Šæœ€æ–¹ä¾¿", time: "07:00-22:00" },
                { name: "ä¸­æ²¹ çŸ¥æœ¬ç«™ (é€²é£¯åº—å‰)", desc: "å…¥çŸ¥æœ¬æº«æ³‰å€å‰æœ€å¾Œä¸€ç«™ï¼Œå»ºè­°è£œçµ¦", time: "07:00-21:00" },
                { name: "ä¸­æ²¹ åˆé¹¿ç«™ (å±±ç·š)", desc: "å°9ç·šæ—ï¼Œåˆé¹¿ç‰§å ´å…¥å£è™•", time: "07:00-21:00" },
                { name: "ä¸­æ²¹ å¤ªéº»é‡Œç«™ (å¤šè‰¯)", desc: "å—è¿´å…¬è·¯ä¸­ç¹¼ç«™ï¼Œå¾€å¤šè‰¯å¿…ç¶“", time: "07:00-21:00" }
            ]},
            { area: "ğŸ”¹ å°æ±è»Šç«™ â†’ å¸‚å€é™„è¿‘", spots: [
                { name: "éµèŠ±æ‘éŸ³æ¨‚èšè½", desc: "æ–‡å‰µå¸‚é›†ã€è£ç½®è—è¡“ (é©åˆæ™šé–“)", time: "30-60åˆ†" },
                { name: "æ­£æ°£è·¯å•†åœˆ", desc: "çŸ¥åå°åƒã€ä¼´æ‰‹ç¦®èšé›†åœ°", time: "20-40åˆ†" }
            ]},
            { area: "ğŸ”¹ å¸‚å€ â†’ å¯Œå²¡ â†’ åˆé¹¿", spots: [
                { name: "å°é‡æŸ³", desc: "å¥‡ç‰¹æµ·å²¸åœ°å½¢ï¼Œå°±åœ¨å¯Œå²¡æ—", time: "40-60åˆ†" },
                { name: "å‘å—éºå€å…¬åœ’", desc: "å¤§è‰çš®ã€æ–‡åŒ–éºè·¡ã€æ¶¼äº­", time: "20-40åˆ†" }
            ]},
            { area: "ğŸ”¹ çŸ¥æœ¬å‘¨é‚Š", spots: [
                { name: "ç™½ç‰ç€‘å¸ƒ", desc: "å°å‹å±±å€ç€‘å¸ƒ (è¼ƒå†·é–€)", time: "20-25åˆ†" },
                { name: "çŸ¥æœ¬æº«æ³‰è¡—", desc: "ç…®æº«æ³‰è›‹ã€é€›å°åº—", time: "20-40åˆ†" }
            ]},
             { area: "ğŸ”¹ å—è¿´æ–¹å‘ (å¤šè‰¯)", spots: [
                { name: "é‡‘æ¨½é™¸é€£å³¶è§€æ™¯å°", desc: "æµ·å²¸å½æœˆæ™¯è‰² (å›ç¨‹æ–¹å‘)", time: "20-30åˆ†" },
                { name: "è¯æºæµ·ç£", desc: "å¤§è‰åœ°ã€æµ·å²¸ç·šæ‹ç…§é»", time: "20-40åˆ†" }
            ]}
        ];

        // Render Functions
        function renderTimeline(data, elementId) {
            const container = document.getElementById(elementId);
            let html = '';
            
            data.forEach(item => {
                const isActivity = item.type === 'activity' || item.type === 'food' || item.type === 'hotel';
                const bgColor = isActivity ? 'bg-white' : 'bg-gray-50';
                const borderColor = isActivity ? 'border-teal-500' : 'border-gray-300';
                const googleMapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.title.replace('å‰å¾€', '').replace('å›', ''))}`;

                html += `
                <div class="relative z-10 mb-6 pl-6">
                    <div class="absolute -left-3 top-0 w-8 h-8 rounded-full ${isActivity ? 'bg-teal-500' : 'bg-gray-400'} text-white flex items-center justify-center shadow-md border-2 border-white">
                        <i class="fas ${item.icon} text-xs"></i>
                    </div>
                    
                    <div class="${bgColor} p-4 rounded-lg card-shadow border-l-4 ${borderColor}">
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-gray-800 text-lg">${item.title}</h3>
                            <span class="text-sm font-mono text-teal-700 font-bold">${item.time}</span>
                        </div>
                        
                        <div class="mt-2 text-sm text-gray-600 flex items-center">
                            ${item.duration ? `<span class="bg-gray-200 px-2 py-0.5 rounded text-xs mr-2"><i class="far fa-clock mr-1"></i>${item.duration}</span>` : ''}
                        </div>
                        
                        <p class="mt-2 text-gray-500 text-sm leading-relaxed">${item.note}</p>
                        
                        ${item.type !== 'end' && item.type !== 'begin' && item.type !== 'carrent' ? `
                        <a href="${googleMapUrl}" target="_blank" class="mt-3 inline-block w-full text-center py-2 rounded border border-teal-500 text-teal-600 text-sm hover:bg-teal-50 transition">
                            <i class="fas fa-location-arrow mr-1"></i> å°èˆª
                        </a>` : ''}
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        function renderExtras() {
            const container = document.getElementById('extra-list');
            let html = '';
            
            extraData.forEach(group => {
                html += `
                <div class="bg-white rounded-lg p-4 card-shadow mb-4">
                    <h3 class="font-bold text-teal-700 border-b pb-2 mb-3">${group.area}</h3>
                    <div class="space-y-3">
                        ${group.spots.map(spot => `
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="font-bold text-gray-800">${spot.name}</div>
                                    <div class="text-xs text-gray-500">${spot.desc}</div>
                                </div>
                                <div class="text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded whitespace-nowrap">${spot.time}</div>
                            </div>
                            <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(spot.name)}" target="_blank" class="text-xs text-blue-500 block mt-1 hover:underline"><i class="fas fa-map-marker-alt"></i> æŸ¥çœ‹ä½ç½®</a>
                        `).join('<hr class="my-2 border-dashed border-gray-200">')}
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        // Tab Switching Logic
        function switchTab(tabName) {
            // Hide all contents
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            // Show selected content
            document.getElementById(tabName).classList.remove('hidden');
            
            // Reset buttons
            document.querySelectorAll('button[id^="btn-"]').forEach(btn => {
                btn.classList.remove('tab-active', 'text-teal-700');
                btn.classList.add('text-gray-500');
            });
            // Highlight active button
            const activeBtn = document.getElementById(`btn-${tabName}`);
            activeBtn.classList.add('tab-active', 'text-teal-700');
            activeBtn.classList.remove('text-gray-500');
        }

// Weather Functions (æ™ºæ…§åˆ‡æ›ç‰ˆï¼š3å°æ™‚æ²å‹• / 12å°æ™‚å›ºå®š)
        async function fetchWeather() {
            const weatherCard = document.getElementById('weather-card');
            const hourlyContainer = document.getElementById('hourly-forecast');
            
            // âœ… æ‚¨çš„ API Key
            const CWA_KEY = 'CWA-238CE5CA-08E3-4392-8F7D-23AAD6B5814E'; 
            
            // è«‹æ±‚ç­–ç•¥ï¼šåŒæ™‚è«‹æ±‚ T (3å°æ™‚) å’Œ å¹³å‡æº«åº¦ (å‚™ç”¨)
            const url = `https://opendata.cwa.gov.tw/api/v1/rest/datastore/F-D0047-039?Authorization=${CWA_KEY}&elementName=T,Wx,PoP12h,PoP6h,å¹³å‡æº«åº¦,å¤©æ°£ç¾è±¡`;

            // å¤©æ°£åœ–ç¤ºå°ç…§
            function getIcon(wxStr) {
                if (!wxStr) return { icon: 'fa-cloud', color: 'text-gray-400' };
                if (wxStr.includes('é›·')) return { icon: 'fa-bolt', color: 'text-purple-500' };
                if (wxStr.includes('é›¨')) return { icon: 'fa-umbrella', color: 'text-blue-500' };
                if (wxStr.includes('æ™´') && wxStr.includes('é›²')) return { icon: 'fa-cloud-sun', color: 'text-orange-400' };
                if (wxStr.includes('æ™´')) return { icon: 'fa-sun', color: 'text-yellow-400' };
                if (wxStr.includes('é™°')) return { icon: 'fa-cloud', color: 'text-gray-500' };
                return { icon: 'fa-cloud', color: 'text-gray-400' };
            }

            // è¬ç”¨å±¬æ€§è®€å– (å¤§å°å¯«/ä¸­æ–‡é€šåƒ)
            function getProp(obj, key) {
                if (!obj) return undefined;
                return obj[key] || 
                       obj[key.charAt(0).toUpperCase() + key.slice(1)] || 
                       obj[key.toLowerCase()];
            }

            try {
                const response = await fetch(url);
                const data = await response.json();

                // 1. æ‰¾ Locations
                const locationsWrapper = getProp(data.records, 'locations');
                if (!locationsWrapper) throw new Error("è³‡æ–™çµæ§‹ç•°å¸¸");

                const allTowns = getProp(locationsWrapper[0], 'location');
                const targetTown = allTowns.find(town => {
                    const name = getProp(town, 'locationName');
                    return name === 'è‡ºæ±å¸‚' || name === 'å°æ±å¸‚';
                });

                if (!targetTown) throw new Error("æ‰¾ä¸åˆ°è‡ºæ±å¸‚");

                // --- 2. æ™ºæ…§è³‡æ–™é¸å– ---
                const elements = getProp(targetTown, 'weatherElement');
                const weatherMap = {};
                
                // æŠŠæ‰€æœ‰æŠ“åˆ°çš„å…ƒç´ æ•´ç†èµ·ä¾†
                elements.forEach(el => {
                    const name = getProp(el, 'elementName');
                    weatherMap[name] = getProp(el, 'time');
                });

                // åˆ¤æ–·è¦ç”¨å“ªå€‹è³‡æ–™æºï¼šå„ªå…ˆç”¨ T (3å°æ™‚)ï¼Œæ²’æœ‰æ‰ç”¨ å¹³å‡æº«åº¦ (12å°æ™‚)
                let mainKey = 'T'; 
                let valKey = 'value'; // T çš„æ•¸å€¼é€šå¸¸æ”¾åœ¨ value æ¬„ä½
                
                if (!weatherMap['T']) {
                    mainKey = 'å¹³å‡æº«åº¦';
                    valKey = 'Temperature'; // å¹³å‡æº«åº¦çš„æ•¸å€¼æ”¾åœ¨ Temperature æ¬„ä½
                }

                // æª¢æŸ¥è³‡æ–™æ˜¯å¦å­˜åœ¨
                if (!weatherMap[mainKey]) throw new Error("æ‰¾ä¸åˆ°æº«åº¦è³‡æ–™");

                // --- 3. åˆ¤æ–·è³‡æ–™å¯†åº¦ (æ±ºå®š UI æ¨¡å¼) ---
                const timeArr = weatherMap[mainKey];
                const startTime1 = new Date(getProp(timeArr[0], 'startTime'));
                const startTime2 = new Date(getProp(timeArr[1], 'startTime'));
                const diffHours = (startTime2 - startTime1) / (1000 * 60 * 60);

                // å¦‚æœé–“éš”å°æ–¼ç­‰æ–¼ 3 å°æ™‚ -> ç”¨æ²å‹•æ¨¡å¼ (Scroll)
                // å¦‚æœé–“éš”å¤§æ–¼ 3 å°æ™‚ (6æˆ–12) -> ç”¨ç¶²æ ¼æ¨¡å¼ (Grid)
                const isHourlyMode = diffHours <= 3;

                // è¼”åŠ©å–å€¼å‡½å¼
                const getValue = (elName, index, vKey = 'value') => {
                    // å˜—è©¦å¤šç¨®å¯èƒ½çš„åå­— (è‹±æ–‡/ä¸­æ–‡)
                    let targetArr = weatherMap[elName];
                    if (!targetArr) {
                        // å˜—è©¦å°æ‡‰ä¸­æ–‡
                        if(elName === 'T') targetArr = weatherMap['å¹³å‡æº«åº¦'];
                        if(elName === 'Wx') targetArr = weatherMap['å¤©æ°£ç¾è±¡'];
                        if(elName === 'PoP') targetArr = weatherMap['12å°æ™‚é™é›¨æ©Ÿç‡'] || weatherMap['PoP12h'] || weatherMap['PoP6h'];
                    }
                    
                    if (!targetArr || !targetArr[index]) return '--';
                    
                    const elVal = getProp(targetArr[index], 'elementValue');
                    if (!elVal || !elVal[0]) return '--';
                    
                    // å˜—è©¦ç›´æ¥å–å€¼ï¼Œæˆ–å–ç‰¹å®š Key
                    let res = getProp(elVal[0], vKey);
                    // å¦‚æœç”¨ value æŠ“ä¸åˆ°ï¼Œè©¦è©¦çœ‹ Temperature/Weather é€™ç¨®å°ˆå±¬ Key
                    if (res === undefined && vKey === 'value') {
                         // æš´åŠ›æ³•ï¼šå–ç¬¬ä¸€å€‹ Key çš„å€¼
                         const keys = Object.keys(elVal[0]);
                         if(keys.length > 0) res = elVal[0][keys[0]];
                    }
                    return res;
                };

                // --- A. ç›®å‰å¤©æ°£ (å¤§å¡ç‰‡) ---
                const curTemp = getValue(mainKey, 0, valKey);
                const curWx = getValue('Wx', 0, 'Weather'); // Wx ç”¨ Weather æˆ– value
                const curRain = getValue('PoP', 0, 'ProbabilityOfPrecipitation');
                
                // ç‚ºäº†é¡¯ç¤ºé«˜ä½æº«ï¼Œéæ­·å‰å¹¾ç­†
                let maxT = -100, minT = 100;
                for(let i=0; i<4; i++) {
                    const t = parseInt(getValue(mainKey, i, valKey));
                    if(!isNaN(t)) {
                        if(t > maxT) maxT = t;
                        if(t < minT) minT = t;
                    }
                }
                if(maxT === -100) { maxT='-'; minT='-'; }

                const iconInfo = getIcon(curWx);
                document.getElementById('current-temp').innerText = curTemp;
                document.getElementById('rain-chance').innerText = curRain;
                document.getElementById('weather-icon').innerHTML = `<i class="fas ${iconInfo.icon} ${iconInfo.color}"></i>`;
                document.getElementById('weather-desc').innerText = `${curWx} (é«˜${maxT}Â° ä½${minT}Â°)`;

                // --- B. æœªä¾†é å ±åˆ—è¡¨ ---
                let html = '';
                
                // å¦‚æœæ˜¯ 3å°æ™‚æ¨¡å¼ï¼Œé¡¯ç¤º 9 å€‹ (ç´„24å°æ™‚)ï¼›å¦‚æœæ˜¯ 12å°æ™‚æ¨¡å¼ï¼Œåªé¡¯ç¤º 3 å€‹
                const limit = isHourlyMode ? 9 : 3; 
                // ç¢ºä¿ä¸è¦è¶…éé™£åˆ—é•·åº¦
                const safeLimit = Math.min(limit, timeArr.length);

                for (let i = 1; i < safeLimit; i++) {
                    const timeBlock = timeArr[i];
                    const startTime = getProp(timeBlock, 'startTime');
                    const timeObj = new Date(startTime);
                    const timeDisplay = startTime.split('T')[1].substring(0, 5);
                    const monthDay = `${timeObj.getMonth()+1}/${timeObj.getDate()}`;

                    const valTemp = getValue(mainKey, i, valKey);
                    const valWx = getValue('Wx', i, 'Weather'); 
                    
                    // é™é›¨æ©Ÿç‡è™•ç† (æ™‚é–“å°æ‡‰)
                    let valRain = '--';
                    // ç°¡æ˜“é‚è¼¯ï¼šæ‹¿å°æ‡‰ index çš„é™é›¨æ©Ÿç‡ï¼Œå¦‚æœæ˜¯ Hourly æ¨¡å¼ï¼Œå¯èƒ½è¦é™¤ä»¥ 2 æˆ– 4 å»å°æ‡‰
                    // é€™è£¡ç°¡åŒ–ï¼šå˜—è©¦æ‰¾æ™‚é–“é‡ç–Š
                    const popArr = weatherMap['PoP12h'] || weatherMap['12å°æ™‚é™é›¨æ©Ÿç‡'] || weatherMap['PoP6h'];
                    if (popArr) {
                        const match = popArr.find(r => 
                            getProp(r, 'startTime') === startTime || 
                            (new Date(getProp(r, 'startTime')) <= timeObj && new Date(getProp(r, 'endTime')) > timeObj)
                        );
                        if (match) {
                            // é™é›¨æ©Ÿç‡çš„å€¼å¯èƒ½åœ¨ value æˆ– ProbabilityOfPrecipitation
                            const pVal = getProp(match.elementValue[0], 'ProbabilityOfPrecipitation') || getProp(match.elementValue[0], 'value');
                            if(pVal) valRain = pVal;
                        }
                    }

                    const subIcon = getIcon(valWx);

                    // æ ¹æ“šæ¨¡å¼èª¿æ•´å¡ç‰‡å¯¬åº¦
                    // Hourly: çª„å¡ç‰‡ (w-20)
                    // 12h: å¯¬å¡ç‰‡ (col-span-1)
                    const cardClass = isHourlyMode 
                        ? "flex-shrink-0 flex flex-col items-center justify-center bg-blue-50 rounded-lg p-2 w-20 mx-1 border border-blue-100"
                        : "flex flex-col items-center justify-center bg-blue-50 rounded-lg p-2 col-span-1 border border-blue-100";

                    html += `
                    <div class="${cardClass}">
                        <span class="text-[10px] text-gray-400 leading-tight">${monthDay}</span>
                        <span class="text-xs text-gray-600 font-bold mb-1">${timeDisplay}</span>
                        <i class="fas ${subIcon.icon} ${subIcon.color} text-xl mb-1"></i>
                        <span class="text-sm font-bold text-gray-800">${valTemp}Â°</span>
                        <div class="text-[10px] text-blue-500 mt-1 flex items-center">
                            <i class="fas fa-tint text-[8px] mr-1"></i>${valRain}%
                        </div>
                    </div>`;
                }

                // è¨­å®šå®¹å™¨æ¨£å¼
                if (isHourlyMode) {
                    // æ©«å‘æ²å‹•
                    hourlyContainer.className = "flex overflow-x-auto pb-2 pt-2 scrollbar-hide"; 
                } else {
                    // 3æ¬„ç¶²æ ¼
                    hourlyContainer.className = "grid grid-cols-3 gap-2 text-center pt-2";
                }
                
                hourlyContainer.innerHTML = html;
                weatherCard.classList.remove('hidden');

            } catch (error) {
                console.error("Weather Error:", error);
                document.getElementById('weather-desc').innerText = "è®€å–å¤±æ•—";
                hourlyContainer.innerHTML = `<div class="p-2 text-red-500 text-xs">${error.message}</div>`;
                weatherCard.classList.remove('hidden');
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderTimeline(day1Data, 'day1-list');
            renderTimeline(day2Data, 'day2-list');
            renderExtras();
            fetchWeather();
        });
    </script>
</body>
</html>
